-- Задача 1. Вивести список офісів східного регіону з ціллю по продажах менше або рівною 350000.00
-- Запит повертає стовпці: ідентифікатор офісу (OfficeID), місто (City) та ідентифікатор керівника (ManagerID).
SELECT 
    OfficeID, 
    City, 
    ManagerID
FROM 
    dbo.OFFICES
WHERE 
    Region = 'East'  -- Фільтрація для офісів східного регіону
    AND TargetSales <= 350000.00;  -- Ціль по продажах менше або рівно 350000.00


-- Задача 2.1. Вивести список замовлень, проведених не в 2008 році, 
-- тільки на ті товари, де ідентифікатор товару (ProductID) містить "A" другим символом або "0" в будь-якому місці.
-- Повертаються всі стовпці з таблиці ORDERS.
SELECT *
FROM 
    dbo.ORDERS
WHERE 
    OrderDate NOT BETWEEN '2008-01-01' AND '2008-12-31'  -- Виключаємо замовлення, проведені у 2008 році
    AND (ProductID LIKE '_A%' OR ProductID LIKE '%0%');  -- Перевірка умов: другий символ "A" або "0" у будь-якому місці


-- Задача 2.2. Вивести загальну суму замовлень за ідентифікатором виробника (MFR) для замовлень, 
-- проведених не в 2008 році, де ідентифікатор товару відповідає певним умовам.
-- Повертається ідентифікатор виробника (MFR), кількість унікальних замовлень та їх загальна сума.
SELECT 
    MFR, 
    COUNT(DISTINCT OrderID) AS UniqueOrders,  -- Підрахунок унікальних замовлень для кожного виробника
    SUM(TotalAmount) AS TotalSum  -- Обчислення загальної суми замовлень
FROM 
    dbo.ORDERS
WHERE 
    OrderDate NOT BETWEEN '2008-01-01' AND '2008-12-31'  -- Виключення замовлень, проведених у 2008 році
    AND (ProductID LIKE '_A%' OR ProductID LIKE '%0%')  -- Перевірка умов для ідентифікатора товару
GROUP BY 
    MFR  -- Групування за виробником
ORDER BY 
    TotalSum ASC;  -- Сортування результатів за загальною сумою у порядку зростання


-- Задача 2.3. Вивести ідентифікатор виробника (MFR) з найбільшою загальною сумою замовлень,
-- враховуючи тільки замовлення, проведені не в 2008 році, та де ідентифікатор товару відповідає певним умовам.
-- Використовуємо TOP 1 WITH TIES для врахування можливих однакових значень.
SELECT TOP 1 WITH TIES
    MFR, 
    SUM(TotalAmount) AS TotalSum  -- Обчислення загальної суми замовлень для кожного виробника
FROM 
    dbo.ORDERS
WHERE 
    OrderDate NOT BETWEEN '2008-01-01' AND '2008-12-31'  -- Виключення замовлень, проведених у 2008 році
    AND (ProductID LIKE '_A%' OR ProductID LIKE '%0%')  -- Перевірка умов для ідентифікатора товару
GROUP BY 
    MFR  -- Групування за виробником
ORDER BY 
    TotalSum DESC;  -- Сортування за спаданням для отримання найбільшої суми


-- Задача 3. Вивести ідентифікатор офісу з найбільшою кількістю працівників на посаді "Sales Rep"
-- віком 29, 45 або 48 років. Використовується TOP 1 WITH TIES для врахування випадків з однаковою кількістю працівників.
SELECT TOP 1 WITH TIES
    OfficeID, 
    COUNT(*) AS EmployeeCount  -- Підрахунок кількості працівників, які відповідають умовам
FROM 
    dbo.SALESREPS
WHERE 
    Position = 'Sales Rep'  -- Фільтрація за посадою "Sales Rep"
    AND Age IN (29, 45, 48)  -- Фільтрація за віком: 29, 45 або 48 років
GROUP BY 
    OfficeID  -- Групування за ідентифікатором офісу
ORDER BY 
    EmployeeCount DESC;  -- Сортування за кількістю працівників у порядку спадання
